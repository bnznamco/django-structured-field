!function(){"use strict";function t(t){const e=JSON.parse(t.dataset.schema);console.log("🧱 schema",e),JSON.parse(t.dataset.uischema);const s=JSON.parse(t.dataset.formdata);console.log("🫐 formData",s);const i=document.getElementById(`id_${t.dataset.name}`),r=new JSONEditor(t,{schema:e,startval:s,max_depth:10,show_errors:"always"});r.on("change",(()=>{i.innerHTML=JSON.stringify(r.getValue())}))}document.addEventListener("DOMContentLoaded",(()=>{JSONEditor.defaults.options.theme="html",JSONEditor.defaults.options.iconlib="fontawesome5",window.JSONEditor.defaults.callbacks={select2:{createQueryParams:function(t,e){return{_q:e.term,page:e.page}},processResultData:function(t,e,s){return{results:e.map((t=>({id:btoa(JSON.stringify(t)),text:t.name}))),pagination:{more:!1}}}}},window.JSONEditor.defaults.editors.select2=class extends window.JSONEditor.defaults.editors.select2{titleFieldsPriority=["__str__","name","title","label","id"];preBuild(){"relation"===this.schema.type&&(this.schema.enum=[]),super.preBuild()}forceAddOption(t,e){this.enum_values.includes(t)||(this.enum_values.push(t),this.enum_options.push(t),this.enum_display.push(e),this.theme.setSelectOptions(this.input,this.enum_options,this.enum_display))}isObject(t){return"object"==typeof t&&!Array.isArray(t)&&null!==t}isString(t){return"string"==typeof t}isArray(t){return Array.isArray(t)}isNumber(t){return"number"==typeof t||!isNaN(t)}isRelationObject(t){return this.isObject(t)&&t.id&&t.model}isB64Encoded(t){return this.isString(t)&&t.match(/^[a-zA-Z0-9-_]+={0,2}$/)}isJSONString(t){try{return this.isString(t)&&this.isObject(JSON.parse(t))}catch(t){return!1}}isb64RelationObject(t){if(this.isB64Encoded(t)){var e=atob(t);return this.isJSONString(e)&&this.isRelationObject(JSON.parse(e))}return!1}decodeB64Object(t){return this.isb64RelationObject(t)?JSON.parse(atob(t)):t}setValue(t,e){if("relation"===this.schema.type){if(this.schema.multiple&&Array.isArray(t)){if(!t.length)return;return t.forEach((t=>{this.isb64RelationObject(t)&&(t=this.decodeB64Object(t));let e=t[this.titleFieldsPriority.find((e=>t[e]))];this.forceAddOption(JSON.stringify(t),e)})),super.setValue(t.map((t=>JSON.stringify(t))),e)}if(this.isRelationObject(t)){let s=t[this.titleFieldsPriority.find((e=>t[e]))];return this.forceAddOption(JSON.stringify(t),s),super.setValue(JSON.stringify(t),e)}if(this.isb64RelationObject(t))return t=this.decodeB64Object(t),this.setValue(t,e);if(this.isJSONString(t))return t=JSON.parse(t),this.setValue(t,e)}return super.setValue(t,e)}typecast(t){return"relation"===this.schema.type&&this.schema.options.select2.allowClear&&null===t?null:super.typecast(t)}updateValue(t){return"relation"===this.schema.type&&this.schema.options.select2.allowClear&&null===t?(this.value=null,null):super.updateValue(t)}getValue(){if("relation"===this.schema.type){if(!this.dependenciesFulfilled)return;return this.schema.multiple?this.isArray(this.value)?this.value?.map((t=>this.typecast(t))):this.value?[this.typecast(this.value)]:[]:this.isb64RelationObject(this.value)?this.decodeB64Object(this.value):this.isRelationObject(this.value)?this.value:this.isJSONString(this.value)?JSON.parse(this.value):this.typecast(this.value)}return super.getValue()}afterInputReady(){super.afterInputReady(),"relation"===this.schema.type&&(this.newEnumAllowed=!0,this.control?.querySelector(".select2-container")?.removeAttribute("style"))}},window.JSONEditor.defaults.resolvers.unshift((function(t){if("relation"===t.type&&"select2"===t.format)return"select2"}));const e=document.querySelectorAll(".structured-field-editor");for(let s=0;s<e.length;s++)t(e[s])}))}();
